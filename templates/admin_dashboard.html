<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .tabs { display: flex; gap: 20px; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; background: #4287f5; color: #fff; border: none; border-radius: 5px 5px 0 0; cursor: pointer; }
        .tab-btn.active { background: #2c5db6; }
        .tab-content { display: none; background: #fff; padding: 20px; border-radius: 0 0 8px 8px; box-shadow: 0 2px 8px #0001; }
        .tab-content.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { padding: 8px 12px; border: 1px solid #ddd; }
        th { background: #f0f0f0; }
        .action-btn { padding: 4px 10px; margin: 0 2px; border: none; border-radius: 3px; cursor: pointer; }
        .approve { background: #4caf50; color: #fff; }
        .reject { background: #f44336; color: #fff; }
        .ban { background: #f44336; color: #fff; }
        .timeout { background: #ff9800; color: #fff; }
    </style>
    <script>
        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            document.getElementById(tab + '-btn').classList.add('active');
        }
        window.onload = function() { showTab('pending'); }
    </script>
</head>
<body>
    <h1>Admin Dashboard</h1>
    <div style="margin-bottom: 20px;">
        <a href="{{ url_for('home') }}" style="color: #4287f5; text-decoration: underline; font-weight: bold;">&larr; Back to Home</a>
    </div>
    <div class="tabs">
        <button class="tab-btn" id="pending-btn" onclick="showTab('pending')">Pending Approvals</button>
        <button class="tab-btn" id="users-btn" onclick="showTab('users')">Users</button>
    </div>

    <!-- Pending Approvals Tab -->
    <div class="tab-content" id="pending">
        <h2>Pending Foods</h2>
        <table>
            <tr>
                <th>Name</th>
                <th>Calories</th>
                <th>Protein</th>
                <th>Carbs</th>
                <th>Fat</th>
                <th>Categories</th>
                <th>Creator</th>
                <th>Actions</th>
            </tr>
            {% for food in foods %}
            <tr>
                <td>{{ food.name }}</td>
                <td>{{ food.calories }}</td>
                <td>{{ food.protein }}</td>
                <td>{{ food.carbs }}</td>
                <td>{{ food.fat }}</td>
                <td>{{ food.categories|join(', ') }}</td>
                <td>{{ food.creator }}</td>
                <td>
                    <form action="{{ url_for('admin.approve_food', name=food.name) }}" method="post" style="display:inline;">
                        <button class="action-btn approve" type="submit">Approve</button>
                    </form>
                    <form action="{{ url_for('admin.reject_food', name=food.name) }}" method="post" style="display:inline;">
                        <button class="action-btn reject" type="submit">Reject</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="8">No pending foods.</td></tr>
            {% endfor %}
        </table>

        <h2>Pending Workouts</h2>
        <table>
            <tr>
                <th>Name</th>
                <th>Categories</th>
                <th>Creator</th>
                <th>Actions</th>
            </tr>
            {% for workout in workouts %}
            <tr>
                <td>{{ workout.name }}</td>
                <td>{{ workout.categories|join(', ') }}</td>
                <td>{{ workout.creator }}</td>
                <td>
                    <form action="{{ url_for('admin.approve_workout', name=workout.name) }}" method="post" style="display:inline;">
                        <button class="action-btn approve" type="submit">Approve</button>
                    </form>
                    <form action="{{ url_for('admin.reject_workout', name=workout.name) }}" method="post" style="display:inline;">
                        <button class="action-btn reject" type="submit">Reject</button>
                    </form>
                </td>
            </tr>
            {% else %}
            <tr><td colspan="4">No pending workouts.</td></tr>
            {% endfor %}
        </table>

        <h3>Pending Foods for Approval</h3>
        {% if pending_foods %}
          <ul>
            {% for food in pending_foods %}
              <li>
                {{ food.name }} ({{ food.calories }} kcal)
                <!-- Approve button example -->
                <form action="{{ url_for('admin.approve_food', name=food.name) }}" method="post" style="display:inline;">
                  <button type="submit">Approve</button>
                </form>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p>No foods pending approval.</p>
        {% endif %}
    </div>

    <!-- Users Tab -->
    <div class="tab-content" id="users">
        <h2>Users</h2>
        <table>
            <tr>
                <th>Username</th>
                <th>Role</th>
                <th>Suspended Until</th>
                <th>Actions</th>
            </tr>
            {% for user in users %}
            <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.role }}</td>
                <td>{{ user.suspended_until or 'Active' }}</td>
                <td>
                    {% if user.role != 'admin' %}
                    <form action="{{ url_for('admin.ban_user', username=user.username) }}" method="post" style="display:inline;">

                        <button class="action-btn ban" type="submit">Ban</button>
                    </form>
                    <form action="{{ url_for('admin.timeout_user', username=user.username) }}" method="post" style="display:inline;">
                        <button class="action-btn timeout" type="submit">Timeout 7d</button>
                    </form>
                    {% if user.suspended_until %}
                    <form action="{{ url_for('admin.unban_user', username=user.username) }}" method="post" style="display:inline;">
                        <button class="action-btn approve" type="submit">Unban/Unsuspend</button>
                    </form>
                    {% endif %}
                    {% else %}
                    <span>Admin</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>
</body>
</html>